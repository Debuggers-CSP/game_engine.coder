---
layout: post
title: RPG Review
description: Review your RPG creation journey and finalize your project.
permalink: /rpg/review
comments: True
---

<style>
/* RPG Navigation Sidebar Styles */
.rpg-nav-sidebar {
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    width: 280px;
    background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
    backdrop-filter: blur(10px);
    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
    transform: translateX(-280px);
    transition: transform 0.3s ease;
    z-index: 1000;
    border-right: 2px solid rgba(255, 215, 0, 0.3);
}

.rpg-nav-sidebar.open {
    transform: translateX(0);
}

.nav-toggle {
    position: absolute;
    right: -50px;
    top: 20px;
    width: 50px;
    height: 50px;
    background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-left: none;
    border-radius: 0 10px 10px 0;
    color: #ffd700;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.nav-toggle:hover {
    background: rgba(255, 215, 0, 0.1);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
}

.nav-content {
    padding: 30px 20px;
    height: 100%;
    overflow-y: auto;
}

.nav-title {
    color: #ffd700;
    font-size: 1.5em;
    font-family: 'Cinzel', 'Georgia', serif;
    text-align: center;
    margin-bottom: 10px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.nav-divider {
    height: 2px;
    background: linear-gradient(90deg, transparent, #ffd700, transparent);
    margin-bottom: 20px;
}

.nav-links {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.nav-link {
    display: flex;
    align-items: center;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 10px;
    color: #c0c0c0;
    text-decoration: none;
    transition: all 0.3s ease;
    position: relative;
}

.nav-link:hover:not(.locked) {
    background: rgba(255, 215, 0, 0.1);
    border-color: #ffd700;
    transform: translateX(5px);
}

.nav-link.active {
    background: rgba(255, 215, 0, 0.15);
    border-color: #ffd700;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
}

.nav-link.visited .nav-check {
    display: inline;
}

.nav-link.locked {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

.nav-link.locked .nav-lock {
    display: inline;
}

.nav-link:not(.locked) .nav-lock {
    display: none;
}

.nav-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    background: rgba(255, 215, 0, 0.2);
    border-radius: 50%;
    color: #ffd700;
    font-weight: bold;
    margin-right: 12px;
    flex-shrink: 0;
}

.nav-text {
    flex: 1;
    font-size: 0.95em;
}

.nav-check {
    color: #4cc9f0;
    font-size: 1.2em;
    display: none;
    margin-left: 8px;
}

.nav-lock {
    color: #ff6b6b;
    font-size: 1em;
    margin-left: 8px;
}

@media (max-width: 768px) {
    .rpg-nav-sidebar {
        width: 240px;
        transform: translateX(-240px);
    }
}
</style>

<!-- RPG Navigation Sidebar -->
<div id="rpg-nav-sidebar" class="rpg-nav-sidebar">
  <button id="nav-toggle" class="nav-toggle">‚ò∞</button>
  <div class="nav-content">
    <h3 class="nav-title">üéÆ RPG Creator</h3>
    <div class="nav-divider"></div>
    <nav class="nav-links">
      <a href="/rpg/login" class="nav-link" data-page="1">
        <span class="nav-number">1</span>
        <span class="nav-text">Login</span>
      </a>
      <a href="/rpg/mode" class="nav-link" data-page="2">
        <span class="nav-number">2</span>
        <span class="nav-text">Game Mode</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/story" class="nav-link" data-page="3">
        <span class="nav-number">3</span>
        <span class="nav-text">Story & Narrative</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/character-creation" class="nav-link" data-page="4">
        <span class="nav-number">4</span>
        <span class="nav-text">Character Creation</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/keybindings" class="nav-link" data-page="5">
        <span class="nav-number">5</span>
        <span class="nav-text">Controls</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/review" class="nav-link active" data-page="6" id="review-link">
        <span class="nav-number">6</span>
        <span class="nav-text">Review</span>
        <span class="nav-lock">üîí</span>
        <span class="nav-check">‚úì</span>
      </a>
    </nav>
  </div>
</div>

<script>
// Navigation Sidebar Functionality
const sidebar = document.getElementById('rpg-nav-sidebar');
const navToggle = document.getElementById('nav-toggle');
const currentPage = 6;

// Toggle sidebar
navToggle.addEventListener('click', () => {
    sidebar.classList.toggle('open');
});

// Track page visit
function trackPageVisit(pageNumber) {
    let visitedPages = JSON.parse(localStorage.getItem('rpgVisitedPages') || '[]');
    if (!visitedPages.includes(pageNumber)) {
        visitedPages.push(pageNumber);
        localStorage.setItem('rpgVisitedPages', JSON.stringify(visitedPages));
    }
}

// Check if review page should be unlocked
function updateReviewLock() {
    const visitedPages = JSON.parse(localStorage.getItem('rpgVisitedPages') || '[]');
    const requiredPages = [2, 3, 4, 5];
    const allVisited = requiredPages.every(page => visitedPages.includes(page));
    
    const reviewLink = document.getElementById('review-link');
    if (reviewLink) {
        if (allVisited) {
            reviewLink.classList.remove('locked');
        } else {
            reviewLink.classList.add('locked');
        }
    }
}

// Update visited page indicators
function updateVisitedIndicators() {
    const visitedPages = JSON.parse(localStorage.getItem('rpgVisitedPages') || '[]');
    document.querySelectorAll('.nav-link').forEach(link => {
        const pageNum = parseInt(link.dataset.page);
        if (visitedPages.includes(pageNum)) {
            link.classList.add('visited');
        }
    });
}

// Track current page visit
trackPageVisit(currentPage);
updateVisitedIndicators();
updateReviewLock();
 </script>

<style>
    /* Review page layout */
    .review-wrap { max-width: 1200px; margin: 40px auto; padding: 20px; }
    .review-title { color: #ffd700; font-family: 'Cinzel','Georgia',serif; text-align: center; margin-bottom: 10px; }
    .review-sub { color: #c0c0c0; text-align: center; margin-bottom: 30px; }
    .review-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; }
    .card { background: linear-gradient(145deg, rgba(30,30,60,0.95), rgba(20,20,40,0.95)); border: 2px solid rgba(255,215,0,0.25); border-radius: 14px; padding: 18px; box-shadow: 0 8px 28px rgba(0,0,0,0.5); }
    .card h3 { color: #ffed4e; margin: 0 0 10px 0; font-size: 1.15em; letter-spacing: 0.5px; }
    .card .meta { color: #9aa3b2; font-size: 0.85em; margin-bottom: 6px; }
    .kv { display: grid; grid-template-columns: 160px 1fr; gap: 6px 10px; align-items: start; }
    .kv .k { color: #b8c1d9; }
    .kv .v { color: #e6e6e6; }
    .pill { display: inline-block; padding: 4px 10px; border-radius: 999px; border: 1px solid rgba(255,215,0,0.35); color: #fff; background: rgba(255,215,0,0.08); font-size: 0.85em; }
    .actions { margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; }
    .link-btn { padding: 8px 12px; border-radius: 10px; background: rgba(255,215,0,0.12); border: 1px solid rgba(255,215,0,0.35); color: #ffd700; text-decoration: none; font-size: 0.9em; }
    .link-btn:hover { background: rgba(255,215,0,0.18); }
    .muted { color: #9aa3b2; font-size: 0.95em; }
    .list { display: grid; gap: 10px; }
    .list-item { padding: 10px; border-radius: 10px; background: rgba(0,0,0,0.35); border: 1px solid rgba(255,215,0,0.2); }
    .sprite-wrap { display:flex; align-items:center; gap:14px; }
    .sprite-canvas { image-rendering: pixelated; background: #0f3460; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); width: 64px; height: 64px; }
    .status { margin-top: 8px; font-size: 0.9em; }
    @media (max-width: 860px) { .review-wrap { margin-top: 70px; } }
</style>

<div class="review-wrap">
    <h1 class="review-title">Review & Finalize</h1>
    <p class="review-sub">Here‚Äôs everything we have for your RPG so far.</p>

    <div id="review-grid" class="review-grid">
        <div class="card" id="card-mode">
            <h3>Game Mode</h3>
            <div class="meta" id="mode-status">Loading mode‚Ä¶</div>
            <div><span id="mode-pill" class="pill">‚Äî</span></div>
            <div class="actions">
                <a href="/rpg/mode" class="link-btn">Edit Mode</a>
            </div>
        </div>

        <div class="card" id="card-character">
            <h3>Character Sheet (Lore)</h3>
            <div class="meta" id="character-status">Loading character‚Ä¶</div>
            <div class="kv" id="character-kv" style="display:none;">
                <div class="k">Name</div><div class="v" id="char-name">‚Äî</div>
                <div class="k">Type</div><div class="v" id="char-type">‚Äî</div>
                <div class="k">Motivation</div><div class="v" id="char-motivation">‚Äî</div>
                <div class="k">Greatest Fear</div><div class="v" id="char-fear">‚Äî</div>
                <div class="k">Secret</div><div class="v" id="char-secret">‚Äî</div>
            </div>
            <div class="actions">
                <a href="/rpg/character-creation" class="link-btn">Edit Character</a>
            </div>
        </div>

        <div class="card" id="card-quests">
            <h3>Quest Log</h3>
            <div class="meta" id="quests-status">Loading quests‚Ä¶</div>
            <div id="quests-list" class="list"></div>
            <div class="actions">
                <a href="/rpg/story" class="link-btn">Add More Quests</a>
            </div>
        </div>

        <div class="card" id="card-votes">
            <h3>Story Votes (Love/Skip)</h3>
            <div class="meta" id="votes-status">Loading votes‚Ä¶</div>
            <div class="kv" id="votes-summary" style="display:none;"></div>
            <div class="list" id="votes-list"></div>
            <div class="actions">
                <a href="/rpg/story" class="link-btn">Open Story & Vote</a>
                <button id="votes-refresh" class="link-btn" type="button">Refresh Votes</button>
                <span class="muted" id="votes-origin" style="margin-left:8px;"></span>
            </div>
        </div>

        <div class="card" id="card-visual">
            <h3>Character Visual</h3>
            <div class="sprite-wrap">
                <canvas id="spriteCanvas" class="sprite-canvas" width="16" height="16"></canvas>
                <div>
                    <div class="meta">Preview</div>
                    <div class="muted" id="sprite-status">No saved appearance found. Using a simple default.</div>
                </div>
            </div>
            <div class="actions">
                <a href="/rpg/character-creation" class="link-btn">Adjust Appearance</a>
            </div>
        </div>

        <div class="card" id="card-keys">
            <h3>Key Bindings</h3>
            <div class="meta" id="keys-status">Loading key bindings‚Ä¶</div>
            <div id="keys-kv" class="kv" style="display:none;"></div>
            <div class="actions">
                <a href="/rpg/keybindings" class="link-btn">Edit Controls</a>
            </div>
        </div>
    </div>
</div>

<script>
// -------- Session helpers --------
const API_URL = (location.hostname === 'localhost') ? 'http://localhost:8587/api' : `${window.location.origin}/api`;

function getSession() {
    try { return JSON.parse(localStorage.getItem('userSession') || '{}'); } catch { return {}; }
}

function setStatus(id, text, ok=false) {
    const el = document.getElementById(id);
    if (!el) return;
    el.textContent = text;
    el.style.color = ok ? '#7CFC00' : '#c0c0c0';
}

// -------- Game mode from backend history or session fallback --------
async function loadMode() {
    const statusId = 'mode-status';
    try {
        const res = await fetch(`${API_URL}/rpg_stats`);
        const data = await res.json();
        const history = Array.isArray(data?.history) ? data.history : [];
        const userId = getSession()?.githubId || sessionStorage.getItem('rpgUserId');
        let mode = null, when = null;
        if (userId && history.length) {
            // find last record for user
            for (let i = history.length - 1; i >= 0; i--) {
                const h = history[i];
                if (String(h.userGithubId) === String(userId) && (h.mode === 'chill' || h.mode === 'action')) {
                    mode = h.mode; when = h.timestamp || null; break;
                }
            }
        }
        if (!mode) {
            const pref = JSON.parse(sessionStorage.getItem('rpgCreatorPreferences') || '{}');
            mode = pref.gameMode || localStorage.getItem('rpgGameMode') || null;
        }
        if (mode) {
            document.getElementById('mode-pill').textContent = (mode === 'chill') ? 'Chill / Cozy' : 'Action';
            setStatus(statusId, when ? `From backend (last updated ${new Date(when).toLocaleString()})` : 'From session');
            return mode;
        } else {
            document.getElementById('mode-pill').textContent = 'Unknown';
            setStatus(statusId, 'No selection found');
            return null;
        }
    } catch (e) {
        setStatus('mode-status', `Could not load backend stats (${e.message}).`, false);
        return null;
    }
}

// -------- Character Sheet (Lore) --------
async function loadCharacter() {
    const s = getSession();
    if (!s?.githubId) {
        setStatus('character-status', 'Please login to view your character.');
        return null;
    }
    try {
        const url = `${API_URL}/rpg/character?userGithubId=${encodeURIComponent(s.githubId)}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const body = await res.json();
        const data = body?.character || body; // support either shape
        if (!data) { setStatus('character-status', 'No character found yet.'); return null; }
        document.getElementById('char-name').textContent = data.name || '‚Äî';
        document.getElementById('char-type').textContent = data.gameMode === 'cozy' || data.gameMode === 'chill' ? 'Cozy RPG Character' : 'Action RPG Character';
        document.getElementById('char-motivation').textContent = data.motivation || '‚Äî';
        document.getElementById('char-fear').textContent = data.fear || '‚Äî';
        document.getElementById('char-secret').textContent = data.secret || '‚Äî';
        document.getElementById('character-kv').style.display = '';
        setStatus('character-status', 'Loaded from backend', true);
        return data;
    } catch (e) {
        setStatus('character-status', `Could not load character (${e.message}).`, false);
        return null;
    }
}

// -------- Quest Log --------
async function loadQuests() {
    const s = getSession();
    if (!s?.githubId) { setStatus('quests-status', 'Please login to view your quests.'); return; }
    try {
        const url = `${API_URL}/rpg/quests?userGithubId=${encodeURIComponent(s.githubId)}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const body = await res.json();
        const quests = Array.isArray(body?.quests) ? body.quests : [];
        const list = document.getElementById('quests-list');
        list.innerHTML = '';
        if (!quests.length) {
            list.innerHTML = '<div class="muted">No quests yet. Add your first quest on the Story page.</div>';
            setStatus('quests-status', 'Ready');
            return;
        }
        for (const q of quests) {
            const item = document.createElement('div');
            item.className = 'list-item';
            const loc = (q.location || 'unknown');
            const diff = (q.difficulty || '‚Äî');
            const reward = (q.reward || '‚Äî');
            item.innerHTML = `<div style="color:#ffd700;font-weight:600;">${q.title || '(Untitled Quest)'} </div>
                <div class="muted">Location: ${loc} ‚Ä¢ Difficulty: ${diff} ‚Ä¢ Reward: ${reward}</div>`;
            list.appendChild(item);
        }
        setStatus('quests-status', `Loaded ${quests.length} quest(s)`, true);
    } catch (e) {
        setStatus('quests-status', `Could not load quests (${e.message}).`, false);
    }
}

// -------- Key Bindings --------
async function loadKeybindings(modeGuess) {
    const s = getSession();
    if (!s?.githubId) { setStatus('keys-status', 'Please login to view your key bindings.'); return; }
    // modeGuess from mode card; otherwise try session
    const mode = modeGuess || (JSON.parse(sessionStorage.getItem('rpgCreatorPreferences')||'{}').gameMode) || localStorage.getItem('rpgGameMode') || 'action';
    try {
        const url = `${API_URL}/rpg/keybindings?userGithubId=${encodeURIComponent(s.githubId)}&gameMode=${encodeURIComponent(mode)}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const body = await res.json();
        const binding = body?.binding || body;
        if (!binding) { setStatus('keys-status','No saved key bindings for this mode.'); return; }
        const kv = document.getElementById('keys-kv');
        kv.innerHTML = '';
        const important = [
            ['Move Up','moveUpKey'], ['Move Left','moveLeftKey'], ['Move Down','moveDownKey'], ['Move Right','moveRightKey'],
            ['Interact','interactKey'], ['Jump','jumpKey'], ['Sprint','sprintKey'],
            ['Primary Attack','primaryAttackKey']
        ];
        for (const [label, key] of important) {
            const k = document.createElement('div'); k.className='k'; k.textContent = label;
            const v = document.createElement('div'); v.className='v'; v.textContent = binding[key] || '‚Äî';
            kv.appendChild(k); kv.appendChild(v);
        }
        kv.style.display = '';
        setStatus('keys-status', 'Loaded from backend', true);
    } catch (e) {
        setStatus('keys-status', `Could not load key bindings (${e.message}).`, false);
    }
}

// -------- Character Visual (saved appearance or default) --------
function drawDefaultSprite() {
    const canvas = document.getElementById('spriteCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    // clear
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // simple placeholder similar to character page
    const skin = '#F8C8B0', pants = '#2D1B00', boots = '#1A1A1A', hair = '#3B2F2F', cloth = '#4cc9f0';
    ctx.fillStyle = skin; ctx.fillRect(6,1,4,3); ctx.fillRect(5,4,6,5);
    ctx.fillStyle = hair; ctx.fillRect(5,0,6,2); ctx.fillRect(4,1,8,2); ctx.fillRect(5,3,6,1);
    ctx.fillStyle = cloth; ctx.fillRect(5,4,6,2); ctx.fillRect(3,5,2,2); ctx.fillRect(11,5,2,2);
    ctx.fillStyle = pants; ctx.fillRect(5,9,6,3);
    ctx.fillStyle = boots; ctx.fillRect(4,12,3,2); ctx.fillRect(9,12,3,2);
}

function drawAppearance(appearance) {
    const canvas = document.getElementById('spriteCanvas');
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    // clear
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // colors from appearance with fallbacks
    const hair = appearance?.hairColor || '#3B2F2F';
    const cloth = appearance?.clothingColor || '#4cc9f0';
    const skin = '#F8C8B0';
    const pants = '#2D1B00';
    const boots = '#1A1A1A';
    // same pixel layout as default, but using chosen colors
    ctx.fillStyle = skin; ctx.fillRect(6,1,4,3); ctx.fillRect(5,4,6,5);
    ctx.fillStyle = hair; ctx.fillRect(5,0,6,2); ctx.fillRect(4,1,8,2); ctx.fillRect(5,3,6,1);
    ctx.fillStyle = cloth; ctx.fillRect(5,4,6,2); ctx.fillRect(3,5,2,2); ctx.fillRect(11,5,2,2);
    ctx.fillStyle = pants; ctx.fillRect(5,9,6,3);
    ctx.fillStyle = boots; ctx.fillRect(4,12,3,2); ctx.fillRect(9,12,3,2);
}

// -------- Story Votes --------
async function loadStoryVotes() {
    try {
        const listEl = document.getElementById('votes-list');
        const summaryEl = document.getElementById('votes-summary');
        listEl.innerHTML = '';
        summaryEl.innerHTML = '';

        // Fetch elements
        const origin = (location.hostname==='localhost'? 'http://localhost:8587' : window.location.origin);
        document.getElementById('votes-origin').textContent = `from ${origin}`;
        const res = await fetch(`${origin}/api/rpg/story`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const elements = await res.json();

        // Fetch summary totals
        const resSum = await fetch(`${origin}/api/rpg/story/summary`);
        const totals = resSum.ok ? await resSum.json() : null;

        // Render summary
        if (totals) {
            const catEntries = Object.entries(totals.byCategory || {});
            summaryEl.style.display = '';
            const makeRow = (k, v) => {
                const kEl = document.createElement('div'); kEl.className='k'; kEl.textContent = k;
                const vEl = document.createElement('div'); vEl.className='v'; vEl.textContent = v;
                summaryEl.appendChild(kEl); summaryEl.appendChild(vEl);
            };
            makeRow('Total Loved', String(totals.totalLove || 0));
            makeRow('Total Skipped', String(totals.totalSkip || 0));
            for (const [cat, bucket] of catEntries) {
                makeRow(`${cat} Loved`, String(bucket.love || 0));
                makeRow(`${cat} Skipped`, String(bucket.skip || 0));
            }
        }

        // Render element list with counts
        if (Array.isArray(elements) && elements.length) {
            for (const el of elements) {
                const item = document.createElement('div');
                item.className = 'list-item';
                const cat = el.category || 'Other';
                const name = el.element || `Element ${el.id}`;
                const love = Number(el.love||0);
                const skip = Number(el.skip||0);
                item.innerHTML = `<div style="color:#ffd700;font-weight:600;">${name}</div>
                    <div class="muted">Category: ${cat} ‚Ä¢ ‚ù§Ô∏è Loved: ${love} ‚Ä¢ ‚è≠Ô∏è Skipped: ${skip}</div>`;
                listEl.appendChild(item);
            }
            setStatus('votes-status', `Loaded ${elements.length} story element(s)`, true);
        } else {
            listEl.innerHTML = '<div class="muted">No story elements available yet. Visit Story to load them.</div>';
            setStatus('votes-status', 'Ready');
        }
    } catch (e) {
        setStatus('votes-status', `Could not load votes (${e.message}).`, false);
    }
}

// -------- Bootstrap --------
document.addEventListener('DOMContentLoaded', async () => {
    drawDefaultSprite();
    const mode = await loadMode();
    const character = await loadCharacter();
    if (character?.appearance) {
        drawAppearance(character.appearance);
        document.getElementById('sprite-status').textContent = 'Loaded saved appearance';
    }
    await Promise.all([
        loadQuests(),
        loadKeybindings(mode),
        loadStoryVotes()
    ]);
    const btn = document.getElementById('votes-refresh');
    if (btn) btn.addEventListener('click', loadStoryVotes);
});
</script>
