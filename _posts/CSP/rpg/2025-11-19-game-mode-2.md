---
layout: post
title: Content
description: Letring the user to choose the part they are interested in
permalink: /rpg/content
comments: True
---

<style>
/* åº”ç”¨ç¬¬ä¸€ä¸ªé¡µé¢çš„ä¸»é¢˜æ ·å¼ */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* è¦†ç›–ä¸»é¢˜å®½åº¦é™åˆ¶ */
.page-content .wrapper {
    max-width: 100% !important;
    width: 100% !important;
    padding: 0 !important;
    margin: 0 auto !important;
}

.page-content {
    width: 100% !important;
    max-width: 100% !important;
    padding: 0 !important;
    margin: 0 auto !important;
}

body {
    font-family: 'Cinzel', 'Georgia', serif;
    background: #1a1a2e;
    min-height: 100vh;
    height: auto;
    position: relative;
    overflow-x: hidden;
    overflow-y: auto;
    padding: 0;
    margin: 0;
}

/* RPGå¯¼èˆªä¾§è¾¹æ æ ·å¼ */
.rpg-nav-sidebar {
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    width: 280px;
    background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
    backdrop-filter: blur(10px);
    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
    transform: translateX(-280px);
    transition: transform 0.3s ease;
    z-index: 1000;
    border-right: 2px solid rgba(255, 215, 0, 0.3);
}

.rpg-nav-sidebar.open {
    transform: translateX(0);
}

.nav-toggle {
    position: absolute;
    right: -50px;
    top: 20px;
    width: 50px;
    height: 50px;
    background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-left: none;
    border-radius: 0 10px 10px 0;
    color: #ffd700;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.nav-toggle:hover {
    background: rgba(255, 215, 0, 0.1);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
}

.nav-content {
    padding: 30px 20px;
    height: 100%;
    overflow-y: auto;
}

.nav-title {
    color: #ffd700;
    font-size: 1.5em;
    font-family: 'Cinzel', 'Georgia', serif;
    text-align: center;
    margin-bottom: 10px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.nav-divider {
    height: 2px;
    background: linear-gradient(90deg, transparent, #ffd700, transparent);
    margin-bottom: 20px;
}

.nav-links {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.nav-link {
    display: flex;
    align-items: center;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 10px;
    color: #c0c0c0;
    text-decoration: none;
    transition: all 0.3s ease;
    position: relative;
}

.nav-link:hover:not(.locked) {
    background: rgba(255, 215, 0, 0.1);
    border-color: #ffd700;
    transform: translateX(5px);
}

.nav-link.active {
    background: rgba(255, 215, 0, 0.15);
    border-color: #ffd700;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
}

.nav-link.visited .nav-check {
    display: inline;
}

.nav-link.locked {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

.nav-link.locked .nav-lock {
    display: inline;
}

.nav-link:not(.locked) .nav-lock {
    display: none;
}

.nav-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    background: rgba(255, 215, 0, 0.2);
    border-radius: 50%;
    color: #ffd700;
    font-weight: bold;
    margin-right: 12px;
    flex-shrink: 0;
}

.nav-text {
    flex: 1;
    font-size: 0.95em;
}

.nav-check {
    color: #4cc9f0;
    font-size: 1.2em;
    display: none;
    margin-left: 8px;
}

.nav-lock {
    color: #ff6b6b;
    font-size: 1em;
    margin-left: 8px;
}

/* ä¸»å®¹å™¨ - ä¿æŒåŸå¸ƒå±€ç»“æ„ */
.main-container {
    position: relative;
    z-index: 10;
    width: 100%;
    max-width: 1600px;
    margin: 0 auto;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

/* æ ‡é¢˜éƒ¨åˆ† - é»‘æš—å¥‡å¹»é£æ ¼ */
.header-section {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 20px;
    padding: 40px;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1),
        0 0 40px rgba(255, 215, 0, 0.2);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    text-align: center;
    margin-bottom: 40px;
}

.header-icon {
    font-size: 4em;
    margin-bottom: 20px;
    filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
}

.main-title {
    color: #ffd700;
    font-size: 3em;
    margin-bottom: 15px;
    text-shadow: 
        0 0 10px rgba(255, 215, 0, 0.5),
        0 0 20px rgba(255, 215, 0, 0.3),
        2px 2px 4px rgba(0, 0, 0, 0.8);
    letter-spacing: 3px;
}

.subtitle {
    color: #c0c0c0;
    font-size: 1.2em;
    font-style: italic;
    opacity: 0.9;
}

/* ä¸»å†…å®¹åŒºåŸŸ - ä¿æŒå·¦å³å¸ƒå±€ */
.main-content {
    display: grid;
    grid-template-columns: 3fr 2fr;
    gap: 30px;
    margin-bottom: 40px;
}

@media (max-width: 1024px) {
    .main-content {
        grid-template-columns: 1fr;
    }
}

/* å·¦ä¾§ï¼šæ¸¸æˆæ¨¡å¼å¡ç‰‡ */
.left-column {
    display: flex;
    flex-direction: column;
    gap: 30px;
}

/* æ¸¸æˆæ¨¡å¼å¡ç‰‡ç½‘æ ¼ */
.game-modes-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 25px;
}

@media (max-width: 768px) {
    .game-modes-grid {
        grid-template-columns: 1fr;
    }
}

/* æ¸¸æˆæ¨¡å¼å¡ç‰‡æ ·å¼ - é»‘æš—å¥‡å¹»é£æ ¼ */
.game-mode-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
}

.game-mode-card:hover {
    transform: translateY(-5px);
    box-shadow: 
        0 12px 40px 0 rgba(0, 0, 0, 0.8),
        inset 0 0 30px rgba(255, 215, 0, 0.2),
        0 0 60px rgba(255, 215, 0, 0.3);
}

.game-mode-card.selected {
    border-color: #ffd700;
    box-shadow: 
        0 0 30px rgba(255, 215, 0, 0.4),
        inset 0 0 30px rgba(255, 215, 0, 0.2);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); }
    50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.6); }
    100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); }
}

/* æ¸¸æˆæ¨¡å¼å›¾ç‰‡åŒºåŸŸ */
.game-mode-image-container {
    height: 200px;
    overflow: hidden;
    position: relative;
}

.game-mode-image {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.game-mode-card[data-mode="chill"] .game-mode-image {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(59, 130, 246, 0.2));
}

.game-mode-card[data-mode="action"] .game-mode-image {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(249, 115, 22, 0.2));
}

.mode-emoji {
    font-size: 5em;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
    margin-bottom: 10px;
}

.mode-type-label {
    color: #fff;
    font-size: 1.1em;
    font-weight: bold;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    background: rgba(0, 0, 0, 0.4);
    padding: 5px 15px;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* æ¸¸æˆæ¨¡å¼å†…å®¹ */
.game-mode-content {
    padding: 25px;
}

.game-mode-title {
    color: #ffd700;
    font-size: 1.6em;
    margin-bottom: 12px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.game-mode-description {
    color: #e0e0e0;
    line-height: 1.6;
    margin-bottom: 20px;
    font-size: 1em;
}

.game-mode-features {
    list-style: none;
    padding-left: 0;
    margin-top: 15px;
}

.game-mode-features li {
    padding: 6px 0 6px 25px;
    position: relative;
    color: #c0c0c0;
    margin-bottom: 6px;
    font-size: 0.95em;
}

.game-mode-features li::before {
    content: 'âœ“';
    position: absolute;
    left: 0;
    color: #ffd700;
    font-weight: bold;
}

/* å³ä¸Šè§’é€‰æ‹©åœˆ - ä¿æŒåŸä½ç½®å’Œæ ·å¼ */
.game-mode-selection-indicator {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 28px;
    height: 28px;
    border: 2px solid rgba(255, 215, 0, 0.5);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: all 0.3s ease;
    background: rgba(0, 0, 0, 0.3);
}

.game-mode-card.selected .game-mode-selection-indicator {
    opacity: 1;
    background: rgba(255, 215, 0, 0.2);
    border-color: #ffd700;
}

.selection-dot {
    width: 14px;
    height: 14px;
    background: #ffd700;
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
}

/* å³ä¾§ï¼šç»Ÿè®¡æ•°æ®åŒºåŸŸ */
.right-column {
    display: flex;
    flex-direction: column;
}

/* ç»Ÿè®¡æ•°æ®å¡ç‰‡ - é»‘æš—å¥‡å¹»é£æ ¼ */
.stats-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 20px;
    padding: 30px;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    height: 100%;
}

.stats-title {
    color: #ffd700;
    font-size: 1.8em;
    margin-bottom: 10px;
    text-align: center;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.stats-subtitle {
    color: #c0c0c0;
    text-align: center;
    margin-bottom: 25px;
    font-size: 0.95em;
}

/* ç»Ÿè®¡æ•°æ®å¡ç‰‡ */
.stats-cards-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 25px;
}

.stat-item {
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 12px;
    padding: 18px;
    transition: all 0.3s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.stat-item:hover {
    border-color: rgba(255, 215, 0, 0.4);
    transform: translateY(-2px);
}

.stat-item.chill {
    border-left: 4px solid rgba(34, 197, 94, 0.7);
}

.stat-item.action {
    border-left: 4px solid rgba(239, 68, 68, 0.7);
}

.stat-item.total {
    border-left: 4px solid rgba(59, 130, 246, 0.7);
}

.stat-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.stat-icon {
    font-size: 1.8em;
}

.stat-text h4 {
    color: #ffd700;
    font-size: 1.1em;
    margin-bottom: 4px;
}

.stat-text p {
    color: #c0c0c0;
    font-size: 0.85em;
    opacity: 0.8;
}

.stat-numbers {
    text-align: right;
}

.stat-count {
    color: #fff;
    font-size: 2em;
    font-weight: bold;
    margin-bottom: 4px;
}

.stat-percentage {
    color: #c0c0c0;
    font-size: 1em;
}

/* å›¾è¡¨å®¹å™¨ */
.chart-container {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    height: 250px;
}

.chart-title {
    color: #ffd700;
    font-size: 1.2em;
    margin-bottom: 15px;
    text-align: center;
}

/* é‡ç½®æŒ‰é’® */
.reset-button {
    background: transparent;
    border: 1px solid rgba(255, 215, 0, 0.3);
    color: rgba(255, 215, 0, 0.7);
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Cinzel', 'Georgia', serif;
    transition: all 0.3s ease;
    font-size: 0.9em;
    display: block;
    margin: 0 auto;
    width: fit-content;
}

.reset-button:hover {
    background: rgba(255, 215, 0, 0.1);
    color: #ffd700;
    border-color: #ffd700;
}

/* ç»§ç»­æŒ‰é’®åŒºåŸŸ */
.continue-section {
    text-align: center;
    margin: 40px 0;
}

.continue-button {
    padding: 16px 50px;
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    border: none;
    border-radius: 10px;
    color: #1a1a2e;
    font-size: 1.2em;
    font-weight: bold;
    font-family: 'Cinzel', 'Georgia', serif;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 2px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    position: relative;
    overflow: hidden;
}

.continue-button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.continue-button:hover::before {
    width: 300px;
    height: 300px;
}

.continue-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6);
}

.continue-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.continue-button:disabled:hover::before {
    width: 0;
    height: 0;
}

.selection-hint {
    color: #c0c0c0;
    margin-top: 15px;
    font-style: italic;
    font-size: 0.95em;
}

.selection-hint.selected {
    color: #ffd700;
    font-weight: bold;
}

/* ä¿¡æ¯æç¤º */
.info-note {
    text-align: center;
    color: rgba(192, 192, 192, 0.6);
    font-size: 0.85em;
    margin-top: 20px;
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
    .main-title {
        font-size: 2.2em;
    }
    
    .subtitle {
        font-size: 1em;
    }
    
    .header-section {
        padding: 30px 20px;
    }
    
    .game-mode-content {
        padding: 20px;
    }
    
    .game-mode-title {
        font-size: 1.4em;
    }
    
    .stats-card {
        padding: 20px;
    }
}
</style>

<!-- RPGå¯¼èˆªä¾§è¾¹æ  -->
<div id="rpg-nav-sidebar" class="rpg-nav-sidebar">
  <button id="nav-toggle" class="nav-toggle">â˜°</button>
  <div class="nav-content">
    <h3 class="nav-title">ğŸ® RPG Creator</h3>
    <div class="nav-divider"></div>
    <nav class="nav-links">
      <a href="/rpg/login" class="nav-link" data-page="1">
        <span class="nav-number">1</span>
        <span class="nav-text">Login</span>
      </a>
      <a href="/rpg/content" class="nav-link active" data-page="2">
        <span class="nav-number">2</span>
        <span class="nav-text">Game Mode</span>
        <span class="nav-check">âœ“</span>
      </a>
      <a href="/rpg/story" class="nav-link" data-page="3">
        <span class="nav-number">3</span>
        <span class="nav-text">Story & Narrative</span>
        <span class="nav-check">âœ“</span>
      </a>
      <a href="/rpg/game-creater" class="nav-link" data-page="4">
        <span class="nav-number">4</span>
        <span class="nav-text">Game creator</span>
        <span class="nav-lock">âœ“</span>
      </a>
      <a href="/rpg/keybindings" class="nav-link" data-page="5">
        <span class="nav-number">5</span>
        <span class="nav-text">Controls</span>
        <span class="nav-check">âœ“</span>
      </a>
      <a href="/rpg/systems" class="nav-link" data-page="6">
        <span class="nav-number">6</span>
        <span class="nav-text">Game Systems</span>
        <span class="nav-check">âœ“</span>
      </a>
      <a href="/rpg/review" class="nav-link" data-page="7">
        <span class="nav-number">7</span>
        <span class="nav-text">Review</span>
        <span class="nav-lock">âœ“</span>
      </a>
    </nav>
  </div>
</div>

<div class="main-container">
    <!-- æ ‡é¢˜éƒ¨åˆ† -->
    <div class="header-section">
        <div class="header-icon">ğŸ®</div>
        <h1 class="main-title">Choose Your RPG Adventure</h1>
        <p class="subtitle">
            Select the type of RPG experience you want to create. This will shape the examples and style recommendations throughout the creation process.
        </p>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸï¼šä¿æŒå·¦å³å¸ƒå±€ -->
    <div class="main-content">
        <!-- å·¦ä¾§ï¼šæ¸¸æˆæ¨¡å¼å¡ç‰‡ -->
        <div class="left-column">
            <div class="game-modes-grid">
                <!-- Chill / Cozy RPG å¡ç‰‡ -->
                <div class="game-mode-card" data-mode="chill">
                    <div class="game-mode-image-container">
                        <div class="game-mode-image">
                            <div class="mode-emoji">ğŸŒ¿</div>
                            <div class="mode-type-label">Calm & Exploratory</div>
                        </div>
                    </div>
                    <div class="game-mode-content">
                        <h3 class="game-mode-title">Chill / Cozy RPG</h3>
                        <p class="game-mode-description">
                            Relaxed pace, exploration-focused gameplay with emphasis on storytelling, character development, and atmospheric world-building.
                        </p>
                        <ul class="game-mode-features">
                            <li>Peaceful exploration</li>
                            <li>Rich narrative depth</li>
                            <li>Character relationships</li>
                            <li>Low-stress gameplay</li>
                        </ul>
                    </div>
                    <div class="game-mode-selection-indicator">
                        <div class="selection-dot"></div>
                    </div>
                </div>

                <!-- Action RPG å¡ç‰‡ -->
                <div class="game-mode-card" data-mode="action">
                    <div class="game-mode-image-container">
                        <div class="game-mode-image">
                            <div class="mode-emoji">âš”ï¸</div>
                            <div class="mode-type-label">Fast & Exciting</div>
                        </div>
                    </div>
                    <div class="game-mode-content">
                        <h3 class="game-mode-title">Action RPG</h3>
                        <p class="game-mode-description">
                            Fast-paced, combat-driven experience with intense battles, quick decision-making, and adrenaline-pumping encounters.
                        </p>
                        <ul class="game-mode-features">
                            <li>Dynamic combat system</li>
                            <li>Quick reflexes required</li>
                            <li>Epic boss battles</li>
                            <li>High-intensity moments</li>
                        </ul>
                    </div>
                    <div class="game-mode-selection-indicator">
                        <div class="selection-dot"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šç»Ÿè®¡æ•°æ®åŒºåŸŸ -->
        <div class="right-column">
            <div class="stats-card">
                <h2 class="stats-title">Community Preferences</h2>
                <p class="stats-subtitle">See what other creators are choosing</p>
                
                <div class="stats-cards-container">
                    <!-- Chill ç»Ÿè®¡æ•°æ® -->
                    <div class="stat-item chill">
                        <div class="stat-info">
                            <div class="stat-icon">ğŸŒ¿</div>
                            <div class="stat-text">
                                <h4>Chill / Cozy RPG</h4>
                                <p>Calm & Exploratory</p>
                            </div>
                        </div>
                        <div class="stat-numbers">
                            <div class="stat-count" id="chill-count">0</div>
                            <div class="stat-percentage" id="chill-percentage">0%</div>
                        </div>
                    </div>

                    <!-- Action ç»Ÿè®¡æ•°æ® -->
                    <div class="stat-item action">
                        <div class="stat-info">
                            <div class="stat-icon">âš”ï¸</div>
                            <div class="stat-text">
                                <h4>Action RPG</h4>
                                <p>Fast & Exciting</p>
                            </div>
                        </div>
                        <div class="stat-numbers">
                            <div class="stat-count" id="action-count">0</div>
                            <div class="stat-percentage" id="action-percentage">0%</div>
                        </div>
                    </div>

                    <!-- æ€»è®¡ç»Ÿè®¡æ•°æ® -->
                    <div class="stat-item total">
                        <div class="stat-info">
                            <div class="stat-icon">ğŸ“Š</div>
                            <div class="stat-text">
                                <h4>Total Votes</h4>
                                <p>All community selections</p>
                            </div>
                        </div>
                        <div class="stat-numbers">
                            <div class="stat-count" id="total-count">0</div>
                            <div class="stat-percentage">users</div>
                        </div>
                    </div>
                </div>

                <!-- å›¾è¡¨ -->
                <div class="chart-container">
                    <h3 class="chart-title">Visual Distribution</h3>
                    <canvas id="stats-chart"></canvas>
                </div>

                <!-- é‡ç½®æŒ‰é’® -->
                <button id="reset-stats" class="reset-button">
                    Reset Demo Data
                </button>
            </div>
        </div>
    </div>

    <!-- ç»§ç»­æŒ‰é’® -->
    <div class="continue-section">
        <button id="continue-btn" class="continue-button" disabled>
            Continue to Next Step
        </button>
        <p id="selection-hint" class="selection-hint">
            Please select a game mode to continue
        </p>
    </div>

    <!-- ä¿¡æ¯æç¤º -->
    <div class="info-note">
        <p>Statistics are stored locally in your browser for demonstration purposes.</p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// å¯¼èˆªä¾§è¾¹æ åŠŸèƒ½
document.addEventListener('DOMContentLoaded', function() {
    const navToggle = document.getElementById('nav-toggle');
    const navSidebar = document.getElementById('rpg-nav-sidebar');
    
    if (navToggle && navSidebar) {
        navToggle.addEventListener('click', function() {
            navSidebar.classList.toggle('open');
        });
    }
    
    // æ ‡è®°å·²è®¿é—®çš„é¡µé¢
    const currentPath = window.location.pathname;
    document.querySelectorAll('.nav-link').forEach(link => {
        if (link.getAttribute('href') === currentPath) {
            link.classList.add('active');
            link.classList.add('visited');
            link.querySelector('.nav-check').style.display = 'inline';
        }
    });
});

// æ¸¸æˆæ¨¡å¼é€‰æ‹©å’Œç»Ÿè®¡åŠŸèƒ½
class StatisticsManager {
    constructor() {
        this.storageKey = 'rpgModeStatistics_fallback';
        this.stats = { chill: 0, action: 0, total: 0, history: [] };
        this.chart = null;
        this.API_BASE = "http://localhost:8587/api";
        this.ENDPOINTS = {
            getStats: `${this.API_BASE}/rpg_stats`,
            record: `${this.API_BASE}/rpg_stats/record`,
            reset: `${this.API_BASE}/rpg_stats/reset`,
            health: `${this.API_BASE}/rpg_stats/health`,
        };
    }

    getLocalUserSession() {
        try { return JSON.parse(localStorage.getItem("userSession") || "{}"); }
        catch (e) { return {}; }
    }

    async getUserGithubId() {
        const s = this.getLocalUserSession();
        if (s?.githubId) return String(s.githubId);
        let userId = sessionStorage.getItem('rpgUserId');
        if (userId) return userId;
        userId = 'user_' + Math.random().toString(36).substr(2, 9);
        sessionStorage.setItem('rpgUserId', userId);
        return userId;
    }

    async fetchJSON(url, options = {}) {
        const res = await fetch(url, {
            headers: { 'Content-Type': 'application/json' },
            ...options
        });
        let body = null;
        try { body = await res.json(); } catch (e) {}
        if (!res.ok) {
            const msg = body?.error || body?.message || `HTTP ${res.status}`;
            throw new Error(msg);
        }
        return body;
    }

    async loadFromBackend() {
        const data = await this.fetchJSON(this.ENDPOINTS.getStats, { method: 'GET' });
        this.stats = this.normalizeStats(data);
        this.updateDisplay();
    }

    async recordSelectionBackend(mode) {
        const userGithubId = await this.getUserGithubId();
        const data = await this.fetchJSON(this.ENDPOINTS.record, {
            method: 'POST',
            body: JSON.stringify({ mode, userGithubId })
        });
        this.stats = this.normalizeStats(data);
        this.updateDisplay();
    }

    async resetBackend() {
        const data = await this.fetchJSON(this.ENDPOINTS.reset, { method: 'POST' });
        this.stats = this.normalizeStats(data);
        this.updateDisplay();
    }

    normalizeStats(data) {
        const chill = Number(data?.chill ?? 0);
        const action = Number(data?.action ?? 0);
        const total = Number(data?.total ?? (chill + action));
        const history = Array.isArray(data?.history) ? data.history : [];
        return { chill, action, total, history };
    }

    loadFallback() {
        const defaultStats = { chill: 0, action: 0, total: 0, history: [] };
        try {
            const stored = localStorage.getItem(this.storageKey);
            return stored ? JSON.parse(stored) : defaultStats;
        } catch (e) { return defaultStats; }
    }

    saveFallback() {
        try { localStorage.setItem(this.storageKey, JSON.stringify(this.stats)); }
        catch (e) {}
    }

    async recordSelectionFallback(mode) {
        const userGithubId = await this.getUserGithubId();
        const timestamp = new Date().toISOString();
        this.stats.history.push({ userGithubId, mode, timestamp });
        if (mode === 'chill' || mode === 'action') {
            this.stats[mode]++;
            this.stats.total++;
        }
        this.saveFallback();
        this.updateDisplay();
    }

    resetFallback() {
        this.stats = { chill: 0, action: 0, total: 0, history: [] };
        this.saveFallback();
        this.updateDisplay();
    }

    getPercentage(mode) {
        if (this.stats.total === 0) return 0;
        return Math.round((this.stats[mode] / this.stats.total) * 100);
    }

    updateDisplay() {
        document.getElementById('chill-count').textContent = this.stats.chill;
        document.getElementById('action-count').textContent = this.stats.action;
        document.getElementById('total-count').textContent = this.stats.total;
        document.getElementById('chill-percentage').textContent = `${this.getPercentage('chill')}%`;
        document.getElementById('action-percentage').textContent = `${this.getPercentage('action')}%`;
        this.updateChart();
    }

    updateChart() {
        if (!this.chart) return;
        this.chart.data.datasets[0].data = [this.stats.chill, this.stats.action];
        this.chart.update();
    }

    initChart() {
        const ctx = document.getElementById('stats-chart').getContext('2d');
        
        // è®¾ç½®Chart.jsé»˜è®¤æ ·å¼ä»¥åŒ¹é…ä¸»é¢˜
        Chart.defaults.color = '#fff';
        Chart.defaults.font.family = "'Cinzel', 'Georgia', serif";
        Chart.defaults.font.size = 12;
        
        this.chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Chill / Cozy', 'Action'],
                datasets: [{
                    data: [this.stats.chill, this.stats.action],
                    backgroundColor: [
                        'rgba(34, 197, 94, 0.8)',
                        'rgba(239, 68, 68, 0.8)'
                    ],
                    borderColor: [
                        'rgb(34, 197, 94)',
                        'rgb(239, 68, 68)'
                    ],
                    borderWidth: 2,
                    borderAlign: 'inner'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#ffd700',
                            padding: 15,
                            font: {
                                size: 14,
                                family: "'Cinzel', 'Georgia', serif"
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(20, 20, 40, 0.9)',
                        bodyColor: '#e0e0e0',
                        titleColor: '#ffd700',
                        borderColor: 'rgba(255, 215, 0, 0.3)',
                        borderWidth: 1,
                        titleFont: {
                            family: "'Cinzel', 'Georgia', serif",
                            size: 13
                        },
                        bodyFont: {
                            family: "'Cinzel', 'Georgia', serif",
                            size: 12
                        }
                    }
                },
                cutout: '65%'
            }
        });
    }
}

// åˆå§‹åŒ–é¡µé¢
document.addEventListener('DOMContentLoaded', async function () {
    const gameModeCards = document.querySelectorAll('.game-mode-card');
    const continueBtn = document.getElementById('continue-btn');
    const selectionHint = document.getElementById('selection-hint');
    const resetStatsBtn = document.getElementById('reset-stats');
    let selectedMode = null;

    const statsManager = new StatisticsManager();
    statsManager.initChart();
    statsManager.updateDisplay();

    // å°è¯•ä»åç«¯åŠ è½½ç»Ÿè®¡æ•°æ®
    try {
        await statsManager.loadFromBackend();
    } catch (e) {
        // å¦‚æœåç«¯ä¸å¯ç”¨ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨çš„æ•°æ®
        statsManager.stats = statsManager.loadFallback();
        statsManager.updateDisplay();
    }

    // åˆå§‹åŒ–ä¼šè¯å­˜å‚¨
    if (!sessionStorage.getItem('rpgCreatorPreferences')) {
        sessionStorage.setItem('rpgCreatorPreferences', JSON.stringify({}));
    }

    // æ¸¸æˆæ¨¡å¼å¡ç‰‡é€‰æ‹©åŠŸèƒ½
    gameModeCards.forEach(card => {
        card.addEventListener('click', async function () {
            const mode = this.dataset.mode;
            
            // ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„é€‰ä¸­çŠ¶æ€
            gameModeCards.forEach(c => c.classList.remove('selected'));
            
            // æ·»åŠ å½“å‰å¡ç‰‡çš„é€‰ä¸­çŠ¶æ€
            this.classList.add('selected');
            selectedMode = mode;
            
            // å¯ç”¨ç»§ç»­æŒ‰é’®
            continueBtn.disabled = false;
            
            // æ›´æ–°æç¤ºæ–‡æœ¬
            selectionHint.textContent = `Selected: ${mode === 'chill' ? 'Chill / Cozy RPG' : 'Action RPG'}`;
            selectionHint.classList.add('selected');
            
            // ä¿å­˜é€‰æ‹©åˆ°ä¼šè¯å­˜å‚¨
            const preferences = JSON.parse(sessionStorage.getItem('rpgCreatorPreferences'));
            preferences.gameMode = mode;
            sessionStorage.setItem('rpgCreatorPreferences', JSON.stringify(preferences));
        });
    });

    let hasRecordedMode = false;

    // ç»§ç»­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    continueBtn.addEventListener('click', async function () {
        if (!selectedMode) return;
        if (hasRecordedMode) return;
        
        hasRecordedMode = true;
        continueBtn.disabled = true;
        
        try {
            // å°è¯•è®°å½•é€‰æ‹©åˆ°åç«¯
            await statsManager.recordSelectionBackend(selectedMode);
        } catch (e) {
            // å¦‚æœåç«¯ä¸å¯ç”¨ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨
            statsManager.stats = statsManager.loadFallback();
            await statsManager.recordSelectionFallback(selectedMode);
        }
        
        // è·³è½¬åˆ°ä¸‹ä¸€ä¸ªé¡µé¢
        window.location.href = "/rpg/story";
    });

    // é‡ç½®ç»Ÿè®¡æ•°æ®æŒ‰é’®
    resetStatsBtn.addEventListener('click', async function () {
        if (!confirm("Are you sure you want to reset all statistics?")) return;
        
        try {
            await statsManager.resetBackend();
        } catch (e) {
            statsManager.resetFallback();
        }
    });
});
</script>