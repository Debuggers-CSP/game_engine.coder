---
layout: post
title: Story, Plot & Purpose Tutorial
description: Teach the fundamentals of creating a compelling RPG narrative.
permalink: /rpg/story
comments: True
---

<style>
/* RPG Navigation Sidebar Styles */
.rpg-nav-sidebar {
  position: fixed;
  left: 0;
  top: 0;
  height: 100vh;
  width: 280px;
  background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
  backdrop-filter: blur(10px);
  box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
  transform: translateX(-280px);
  transition: transform 0.3s ease;
  z-index: 1000;
  border-right: 2px solid rgba(255, 215, 0, 0.3);
}

.rpg-nav-sidebar.open {
  transform: translateX(0);
}

.nav-toggle {
  position: absolute;
  right: -50px;
  top: 20px;
  width: 50px;
  height: 50px;
  background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
  border: 2px solid rgba(255, 215, 0, 0.3);
  border-left: none;
  border-radius: 0 10px 10px 0;
  color: #ffd700;
  font-size: 24px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.nav-toggle:hover {
  background: rgba(255, 215, 0, 0.1);
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
}

.nav-content {
  padding: 30px 20px;
  height: 100%;
  overflow-y: auto;
}

.nav-title {
  color: #ffd700;
  font-size: 1.5em;
  font-family: 'Cinzel', 'Georgia', serif;
  text-align: center;
  margin-bottom: 10px;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.nav-divider {
  height: 2px;
  background: linear-gradient(90deg, transparent, #ffd700, transparent);
  margin-bottom: 20px;
}

.nav-links {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.nav-link {
  display: flex;
  align-items: center;
  padding: 15px;
  background: rgba(0, 0, 0, 0.3);
  border: 2px solid rgba(255, 215, 0, 0.2);
  border-radius: 10px;
  color: #c0c0c0;
  text-decoration: none;
  transition: all 0.3s ease;
  position: relative;
}

.nav-link:hover:not(.locked) {
  background: rgba(255, 215, 0, 0.1);
  border-color: #ffd700;
  transform: translateX(5px);
}

.nav-link.active {
  background: rgba(255, 215, 0, 0.15);
  border-color: #ffd700;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
}

.nav-link.visited .nav-check {
  display: inline;
}

.nav-link.locked {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}

.nav-link.locked .nav-lock {
  display: inline;
}

.nav-link:not(.locked) .nav-lock {
  display: none;
}

.nav-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 30px;
  height: 30px;
  background: rgba(255, 215, 0, 0.2);
  border-radius: 50%;
  color: #ffd700;
  font-weight: bold;
  margin-right: 12px;
  flex-shrink: 0;
}

.nav-text {
  flex: 1;
  font-size: 0.95em;
}

.nav-check {
  color: #4cc9f0;
  font-size: 1.2em;
  display: none;
  margin-left: 8px;
}

.nav-lock {
  color: #ff6b6b;
  font-size: 1em;
  margin-left: 8px;
}

@media (max-width: 768px) {
  .rpg-nav-sidebar {
    width: 240px;
    transform: translateX(-240px);
  }
}
</style>

<!-- RPG Navigation Sidebar -->
<div id="rpg-nav-sidebar" class="rpg-nav-sidebar">
  <button id="nav-toggle" class="nav-toggle">‚ò∞</button>
  <div class="nav-content">
    <h3 class="nav-title">üéÆ RPG Creator</h3>
    <div class="nav-divider"></div>
    <nav class="nav-links">
      <a href="/rpg/login" class="nav-link" data-page="1">
        <span class="nav-number">1</span>
        <span class="nav-text">Login</span>
      </a>
      <a href="/rpg/mode" class="nav-link" data-page="2">
        <span class="nav-number">2</span>
        <span class="nav-text">Game Mode</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/story" class="nav-link active" data-page="3">
        <span class="nav-number">3</span>
        <span class="nav-text">Story & Narrative</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/character-creation" class="nav-link" data-page="4">
        <span class="nav-number">4</span>
        <span class="nav-text">Character Creation</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/controls" class="nav-link" data-page="5">
        <span class="nav-number">5</span>
        <span class="nav-text">Controls</span>
        <span class="nav-check">‚úì</span>
      </a>
      <a href="/rpg/review" class="nav-link locked" data-page="6" id="review-link">
        <span class="nav-number">6</span>
        <span class="nav-text">Review</span>
        <span class="nav-lock">üîí</span>
        <span class="nav-check">‚úì</span>
      </a>
    </nav>
  </div>
</div>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Override theme wrapper constraints for page content only */
.page-content .wrapper {
    max-width: 100% !important;
    width: 100% !important;
    padding: 0 !important;
    margin: 0 auto !important;
}

.page-content {
    width: 100% !important;
    max-width: 100% !important;
    padding: 0 !important;
    margin: 0 auto !important;
}

.opencs_root {
    max-width: 100% !important;
    width: 100% !important;
    margin: 0 auto !important;
}

/* Keep header centered */
.site-header .wrapper {
    max-width: 1200px !important;
    margin: 0 auto !important;
    padding: 0 20px !important;
    width: 100% !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    gap: 30px !important;
}

.site-header {
    max-width: 100% !important;
}

.site-header .site-nav {
    float: none !important;
    text-align: center !important;
    position: static !important;
    display: flex !important;
    align-items: center !important;
}

.site-header .site-title {
    float: none !important;
    order: -1 !important;
}

body {
    font-family: 'Cinzel', 'Georgia', serif;
    background: #1a1a2e;
    min-height: 100vh;
    height: auto;
    position: relative;
    overflow-x: hidden;
    overflow-y: auto;
    padding: 0;
    margin: 0;
}

/* Animated background particles */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        radial-gradient(2px 2px at 20% 30%, white, transparent),
        radial-gradient(2px 2px at 60% 70%, white, transparent),
        radial-gradient(1px 1px at 50% 50%, white, transparent),
        radial-gradient(1px 1px at 80% 10%, white, transparent),
        radial-gradient(2px 2px at 90% 60%, white, transparent);
    background-size: 200% 200%;
    animation: stars 20s linear infinite;
    opacity: 0.3;
    z-index: 0;
}

@keyframes stars {
    from { transform: translate(0, 0); }
    to { transform: translate(-50%, -50%); }
}

.container {
    position: relative;
    z-index: 10;
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

.header-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 20px;
    padding: 40px;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1),
        0 0 40px rgba(255, 215, 0, 0.2);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    text-align: center;
    margin-bottom: 40px;
}

.title-icon {
    font-size: 4em;
    margin-bottom: 20px;
    filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
}

.main-title {
    color: #ffd700;
    font-size: 3em;
    margin-bottom: 15px;
    text-shadow: 
        0 0 10px rgba(255, 215, 0, 0.5),
        0 0 20px rgba(255, 215, 0, 0.3),
        2px 2px 4px rgba(0, 0, 0, 0.8);
    letter-spacing: 3px;
}

.subtitle {
    color: #c0c0c0;
    font-size: 1.2em;
    font-style: italic;
    opacity: 0.9;
}

.content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 40px;
    margin-bottom: 60px;
    max-width: none;
}

.section-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 20px;
    padding: 30px;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1);
    border: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.section-card:hover {
    transform: translateY(-5px);
    box-shadow: 
        0 12px 40px 0 rgba(0, 0, 0, 0.8),
        inset 0 0 30px rgba(255, 215, 0, 0.2),
        0 0 60px rgba(255, 215, 0, 0.3);
}

.section-icon {
    font-size: 2.5em;
    margin-bottom: 15px;
    display: block;
}

.section-title {
    color: #ffd700;
    font-size: 1.8em;
    margin-bottom: 15px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.section-content {
    color: #e0e0e0;
    line-height: 1.8;
    font-size: 1em;
}

.section-content ul {
    list-style: none;
    padding-left: 0;
    margin-top: 15px;
}

.section-content li {
    padding: 8px 0 8px 25px;
    position: relative;
    color: #c0c0c0;
}

.section-content li::before {
    content: '‚öîÔ∏è';
    position: absolute;
    left: 0;
    font-size: 0.8em;
}

.prompt-box {
    background: rgba(0, 0, 0, 0.4);
    border-left: 4px solid #ffd700;
    padding: 15px 20px;
    margin: 15px 0;
    border-radius: 5px;
    color: #ffed4e;
    font-style: italic;
}

.generator-card {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    border-radius: 0;
    padding: 50px 0;
    box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(255, 215, 0, 0.1);
    border: none;
    border-top: 2px solid rgba(255, 215, 0, 0.3);
    border-bottom: 2px solid rgba(255, 215, 0, 0.3);
    backdrop-filter: blur(10px);
    text-align: center;
    margin: 0;
    width: 100%;
    max-width: 100%;
}

.generator-title {
    color: #ffd700;
    font-size: 2em;
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.generator-btn {
    padding: 16px 40px;
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    border: none;
    border-radius: 10px;
    color: #1a1a2e;
    font-size: 1.2em;
    font-weight: bold;
    font-family: 'Cinzel', 'Georgia', serif;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 2px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    position: relative;
    overflow: hidden;
}

.generator-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.generator-btn:hover::before {
    width: 300px;
    height: 300px;
}

.generator-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6);
}

.result-box {
    margin-top: 30px;
    padding: 25px;
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid #ffd700;
    border-radius: 15px;
    min-height: 100px;
    display: none;
}

.result-box.active {
    display: block;
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.result-text {
    color: #ffd700;
    font-size: 1.3em;
    line-height: 1.8;
    text-align: left;
}

.result-label {
    color: #ffed4e;
    font-weight: bold;
    margin-top: 15px;
    display: block;
}

/* Tutorial Section Styles */
.tutorial-section {
    background: linear-gradient(145deg, rgba(30, 30, 60, 0.95), rgba(20, 20, 40, 0.95));
    padding: 50px 0;
    border-bottom: 2px solid rgba(255, 215, 0, 0.3);
}

.tutorial-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 25px;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 40px;
    align-items: start;
}

.tutorial-card {
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s ease;
    height: auto;
}

.tutorial-card:hover {
    border-color: #ffd700;
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(255, 215, 0, 0.2);
}

.tutorial-header {
    background: rgba(255, 215, 0, 0.15);
    padding: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.3s ease;
}

.tutorial-header:hover {
    background: rgba(255, 215, 0, 0.25);
}

.tutorial-icon {
    font-size: 1.8em;
    margin-right: 12px;
}

.tutorial-title {
    color: #ffd700;
    font-size: 1.2em;
    font-weight: bold;
    flex: 1;
}

.tutorial-toggle {
    color: #ffd700;
    font-size: 1.2em;
    transition: transform 0.3s ease;
}

.tutorial-card.expanded .tutorial-toggle {
    transform: rotate(180deg);
}

.tutorial-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
    padding: 0 20px;
    opacity: 0;
    transition: max-height 0.4s ease, opacity 0.3s ease, padding 0.4s ease;
}

.tutorial-card.expanded .tutorial-content {
    max-height: 800px;
    padding: 20px;
    opacity: 1;
}

.tutorial-content ul {
    list-style: none;
    padding: 0;
    margin: 15px 0;
}

.tutorial-content li {
    padding: 8px 0 8px 25px;
    position: relative;
    color: #c0c0c0;
    line-height: 1.6;
}

.tutorial-content li::before {
    content: '‚ú¶';
    position: absolute;
    left: 0;
    color: #4cc9f0;
    font-size: 0.9em;
}

.tutorial-prompt {
    background: rgba(76, 201, 240, 0.1);
    border-left: 4px solid #4cc9f0;
    padding: 12px 15px;
    margin: 15px 0;
    border-radius: 5px;
    color: #4cc9f0;
    font-style: italic;
    font-size: 0.95em;
}

.tutorial-example {
    background: rgba(255, 215, 0, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.3);
    padding: 12px 15px;
    margin: 15px 0;
    border-radius: 8px;
    color: #ffed4e;
}

.tutorial-example strong {
    color: #ffd700;
}

@media (max-width: 768px) {
    .tutorial-grid {
        grid-template-columns: 1fr;
    }
}

.mode-selector {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-bottom: 30px;
}

.mode-btn {
    padding: 12px 30px;
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 10px;
    color: #c0c0c0;
    font-size: 1em;
    font-family: 'Cinzel', 'Georgia', serif;
    cursor: pointer;
    transition: all 0.3s ease;
}

.mode-btn:hover {
    border-color: #ffd700;
    color: #ffd700;
    transform: translateY(-2px);
}

.mode-btn.active {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    color: #1a1a2e;
    border-color: #ffd700;
    font-weight: bold;
}

.mode-indicator {
    text-align: center;
    color: #c0c0c0;
    font-size: 0.9em;
    margin-bottom: 20px;
    font-style: italic;
}

.cozy-only {
    display: none;
}

.action-only {
    display: block;
}

.example-card {
    background: rgba(0, 0, 0, 0.3);
    padding: 20px;
    border-radius: 10px;
    border: 1px solid rgba(255, 215, 0, 0.2);
    margin: 15px 0;
}

.example-title {
    color: #ffd700;
    font-weight: bold;
    margin-bottom: 10px;
}

.example-text {
    color: #c0c0c0;
    line-height: 1.6;
}

/* Responsive design */
  @media (max-width: 1200px) {
    .generator-card {
        padding: 40px 0;
    }
  }

  @media (max-width: 768px) {
    .content-grid {
        grid-template-columns: 1fr;
        gap: 25px;
    }
    
    .main-title {
        font-size: 2em;
    }
    
    .section-title {
        font-size: 1.5em;
    }
    
    .generator-card {
        padding: 30px 0;
    }
  }

  /* RPG Navigation Sidebar Styles */
  .rpg-nav-sidebar {
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    width: 280px;
    background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
    backdrop-filter: blur(10px);
    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
    transform: translateX(-280px);
    transition: transform 0.3s ease;
    z-index: 1000;
    border-right: 2px solid rgba(255, 215, 0, 0.3);
  }

  .rpg-nav-sidebar.open {
    transform: translateX(0);
  }

  .nav-toggle {
    position: absolute;
    right: -50px;
    top: 20px;
    width: 50px;
    height: 50px;
    background: linear-gradient(145deg, rgba(20, 20, 40, 0.98), rgba(10, 10, 20, 0.98));
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-left: none;
    border-radius: 0 10px 10px 0;
    color: #ffd700;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .nav-toggle:hover {
    background: rgba(255, 215, 0, 0.1);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
  }

  .nav-content {
    padding: 30px 20px;
    height: 100%;
    overflow-y: auto;
  }

  .nav-title {
    color: #ffd700;
    font-size: 1.5em;
    font-family: 'Cinzel', 'Georgia', serif;
    text-align: center;
    margin-bottom: 10px;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  .nav-divider {
    height: 2px;
    background: linear-gradient(90deg, transparent, #ffd700, transparent);
    margin-bottom: 20px;
  }

  .nav-links {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .nav-link {
    display: flex;
    align-items: center;
    padding: 15px;
    background: rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(255, 215, 0, 0.2);
    border-radius: 10px;
    color: #c0c0c0;
    text-decoration: none;
    transition: all 0.3s ease;
    position: relative;
  }

  .nav-link:hover:not(.locked) {
    background: rgba(255, 215, 0, 0.1);
    border-color: #ffd700;
    transform: translateX(5px);
  }

  .nav-link.active {
    background: rgba(255, 215, 0, 0.15);
    border-color: #ffd700;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
  }

  .nav-link.visited .nav-check {
    display: inline;
  }

  .nav-link.locked {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  .nav-link.locked .nav-lock {
    display: inline;
  }

  .nav-link:not(.locked) .nav-lock {
    display: none;
  }

  .nav-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    background: rgba(255, 215, 0, 0.2);
    border-radius: 50%;
    color: #ffd700;
    font-weight: bold;
    margin-right: 12px;
    flex-shrink: 0;
  }

  .nav-text {
    flex: 1;
    font-size: 0.95em;
  }

  .nav-check {
    color: #4cc9f0;
    font-size: 1.2em;
    display: none;
    margin-left: 8px;
  }

  .nav-lock {
    color: #ff6b6b;
    font-size: 1em;
    margin-left: 8px;
  }

  @media (max-width: 768px) {
    .rpg-nav-sidebar {
      width: 240px;
      transform: translateX(-240px);
    }
  }
</style><div class="container">
    <!-- Tutorial Section -->
    <div class="tutorial-section">
        <h2 class="generator-title" style="padding: 0 40px; max-width: 1400px; margin: 0 auto 30px; width: 100%; text-align: center;">üìñ RPG Narrative Tutorial</h2>
        <p style="color: #c0c0c0; margin-bottom: 40px; padding: 0 40px; max-width: 1400px; margin-left: auto; margin-right: auto; text-align: center;">Click each card to learn the fundamentals of creating a compelling RPG story</p>
        
        <div class="tutorial-grid">
            <!-- Card 1: Main Storyline -->
            <div class="tutorial-card">
                <div class="tutorial-header">
                    <span class="tutorial-icon">üìú</span>
                    <span class="tutorial-title">Crafting Your Storyline</span>
                    <span class="tutorial-toggle">‚ñº</span>
                </div>
                <div class="tutorial-content">
                    <p style="color: #c0c0c0; margin-bottom: 10px;">A great RPG story needs a clear beginning, middle, and end:</p>
                    <ul>
                        <li>Start with a compelling hook that draws players in</li>
                        <li>Build tension through rising action and challenges</li>
                        <li>Create a climactic moment where stakes are highest</li>
                        <li>Provide satisfying resolution and consequences</li>
                    </ul>
                    <div class="tutorial-example">
                        <strong>Example:</strong> The kingdom is threatened by an ancient evil awakening. Heroes must gather mystical artifacts, face moral dilemmas, and unite warring factions before the final battle.
                    </div>
                </div>
            </div>

            <!-- Card 2: World Design -->
            <div class="tutorial-card">
                <div class="tutorial-header">
                    <span class="tutorial-icon">üó∫Ô∏è</span>
                    <span class="tutorial-title">Designing Your World</span>
                    <span class="tutorial-toggle">‚ñº</span>
                </div>
                <div class="tutorial-content">
                    <p style="color: #c0c0c0; margin-bottom: 10px;">Create a living, breathing world with distinct locations:</p>
                    <ul>
                        <li><strong>Towns:</strong> Safe havens with shops, NPCs, and quests</li>
                        <li><strong>Forests:</strong> Mysterious, dangerous, full of secrets</li>
                        <li><strong>Dungeons:</strong> Challenge-filled areas with rewards</li>
                        <li><strong>Factions:</strong> Groups with their own goals and conflicts</li>
                    </ul>
                    <div class="tutorial-prompt">
                        üí° Tip: Each location should have a unique identity, history, and purpose in your story.
                    </div>
                </div>
            </div>

            <!-- Card 3: Hero's Purpose -->
            <div class="tutorial-card">
                <div class="tutorial-header">
                    <span class="tutorial-icon">‚öîÔ∏è</span>
                    <span class="tutorial-title">Hero's Purpose & Goal</span>
                    <span class="tutorial-toggle">‚ñº</span>
                </div>
                <div class="tutorial-content">
                    <p style="color: #c0c0c0; margin-bottom: 10px;">Give your heroes clear motivation and direction:</p>
                    <ul>
                        <li>Define what the hero wants (treasure, revenge, justice)</li>
                        <li>Establish what the hero needs (growth, redemption, truth)</li>
                        <li>Create personal stakes beyond saving the world</li>
                        <li>Allow room for character development and change</li>
                    </ul>
                    <div class="tutorial-prompt">
                        ‚ùì Ask yourself: "Why does THIS hero care about THIS quest?"
                    </div>
                </div>
            </div>

            <!-- Card 4: Conflict -->
            <div class="tutorial-card">
                <div class="tutorial-header">
                    <span class="tutorial-icon">‚ö°</span>
                    <span class="tutorial-title">Building Conflict</span>
                    <span class="tutorial-toggle">‚ñº</span>
                </div>
                <div class="tutorial-content">
                    <p style="color: #c0c0c0; margin-bottom: 10px;">Meaningful conflict drives your narrative forward:</p>
                    <ul>
                        <li><strong>External:</strong> Villains, monsters, environmental dangers</li>
                        <li><strong>Internal:</strong> Doubts, fears, moral dilemmas</li>
                        <li><strong>Interpersonal:</strong> Rivalries, betrayals, alliances</li>
                        <li><strong>Societal:</strong> Laws, traditions, prejudices</li>
                    </ul>
                    <div class="tutorial-example">
                        <strong>Example:</strong> A hero must defeat an evil sorcerer (external), while struggling with inherited dark magic (internal), and convincing skeptical allies to trust them (interpersonal).
                    </div>
                </div>
            </div>

            <!-- Card 5: Character Motivations -->
            <div class="tutorial-card">
                <div class="tutorial-header">
                    <span class="tutorial-icon">üí≠</span>
                    <span class="tutorial-title">Character Motivations</span>
                    <span class="tutorial-toggle">‚ñº</span>
                </div>
                <div class="tutorial-content">
                    <p style="color: #c0c0c0; margin-bottom: 10px;">Deep characters have layered motivations:</p>
                    <ul>
                        <li>What do they desire most in the world?</li>
                        <li>What are they afraid of losing?</li>
                        <li>What secret do they hide from others?</li>
                        <li>How do their past experiences shape their choices?</li>
                    </ul>
                    <div class="tutorial-prompt">
                        ‚ùì Example Prompts: "What is your character afraid of?" | "What would they sacrifice everything for?" | "What lie do they believe about themselves?"
                    </div>
                </div>
            </div>

            <!-- Card 6: Side Quests -->
            <div class="tutorial-card">
                <div class="tutorial-header">
                    <span class="tutorial-icon">üéØ</span>
                    <span class="tutorial-title">Side Quests & World Depth</span>
                    <span class="tutorial-toggle">‚ñº</span>
                </div>
                <div class="tutorial-content">
                    <p style="color: #c0c0c0; margin-bottom: 10px;">Side quests enrich your world and provide player choice:</p>
                    <ul>
                        <li>Reveal backstory and lore about the world</li>
                        <li>Develop relationships with NPCs</li>
                        <li>Offer unique rewards and alternative paths</li>
                        <li>Provide breaks from main story tension</li>
                        <li>Show consequences of player choices</li>
                    </ul>
                    <div class="tutorial-example">
                        <strong>Good Side Quest:</strong> Help a blacksmith recover their stolen heirloom. Reward: Discount on weapons + they join the final battle. Bad version: "Collect 10 flowers" with no story impact.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- World Map Quest Tracker -->
    <div class="generator-card">
        <div style="width: 100%;">
        <h2 class="generator-title" style="padding: 0 40px;">World Map Quest Tracker</h2>
        <p style="color: #c0c0c0; margin-bottom: 25px; padding: 0 40px;">Build your campaign by creating quests for different locations!</p>
        
        <form id="quest-form" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; text-align: left; max-width: 1400px; margin: 0 auto; padding: 0 40px; width: 100%;">
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Quest Title:</label>
                <input type="text" id="quest-title" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
                <small style="color: #a0a0a0; font-size: 0.85em; margin-top: 5px; display: block;">The name of your quest (e.g., "The Lost Crown of Eldoria")</small>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Location Type:</label>
                <select id="quest-location" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
                    <option value="">Select a location...</option>
                    <option value="town">Town</option>
                    <option value="dungeon">Dungeon</option>
                    <option value="forest">Forest</option>
                    <option value="mountain">Mountain</option>
                    <option value="castle">Castle</option>
                    <option value="cave">Cave</option>
                    <option value="ocean">Ocean</option>
                    <option value="desert">Desert</option>
                </select>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Quest Objective:</label>
                <textarea id="quest-objective" required rows="3"
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em; resize: vertical;"></textarea>
                <small style="color: #a0a0a0; font-size: 0.85em; margin-top: 5px; display: block;">What players need to accomplish (e.g., "Defeat the dragon guarding the ancient temple")</small>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Difficulty Level:</label>
                <select id="quest-difficulty" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
                    <option value="">Select difficulty...</option>
                    <option value="easy">‚≠ê Easy</option>
                    <option value="medium">‚≠ê‚≠ê Medium</option>
                    <option value="hard">‚≠ê‚≠ê‚≠ê Hard</option>
                    <option value="epic">‚≠ê‚≠ê‚≠ê‚≠ê Epic</option>
                </select>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; color: #ffd700; margin-bottom: 8px; font-weight: bold;">Reward:</label>
                <input type="text" id="quest-reward" required
                    style="width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.4); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 8px; color: #e0e0e0; font-family: 'Cinzel', 'Georgia', serif; font-size: 1em;">
                <small style="color: #a0a0a0; font-size: 0.85em; margin-top: 5px; display: block;">What players earn for completing the quest (e.g., "500 gold coins and a magic sword")</small>
            </div>
            
            <div style="grid-column: 1 / -1;">
                <button type="submit" class="generator-btn" style="width: 100%; max-width: 500px; margin: 0 auto; display: block;">
                    <span style="position: relative; z-index: 1;">Add Quest to Log</span>
                </button>
            </div>
        </form>
        
        <div id="quest-log-result" class="result-box" style="margin: 30px auto 0; padding: 20px 40px; max-width: 1400px; width: 100%;">
            <h3 style="color: #ffd700; margin-bottom: 20px; text-align: center;">üìú Your Quest Log</h3>
            <div id="quest-log-content" class="result-text"></div>
            <button onclick="downloadQuestLog()" class="generator-btn" style="margin-top: 20px; padding: 12px 30px; font-size: 1em;">
                <span style="position: relative; z-index: 1;">Download Quest Log</span>
            </button>
        </div>
        </div>
    </div>

    <!-- Story Element Generator -->
    <div class="generator-card">
        <div style="width: 100%;">
        <h2 class="generator-title" style="padding: 0 40px; max-width: 1400px; margin: 0 auto; width: 100%;">Story Element Generator</h2>
        <p style="color: #c0c0c0; margin-bottom: 25px; padding: 0 40px; max-width: 1400px; margin-left: auto; margin-right: auto; width: 100%;">Get inspired with random story elements for your RPG! Vote on your favorites. Heart for 'Love It' or Skip for 'Skip It'!</p>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0; margin-top: 30px; width: 100%;">
            <!-- Main Plot Hooks -->
            <div style="background: linear-gradient(135deg, rgba(76, 201, 240, 0.15), rgba(0, 0, 0, 0.3)); border: 1px solid rgba(76, 201, 240, 0.4); border-radius: 0; padding: 25px; display: flex; flex-direction: column; min-height: 400px;">
                <h3 style="color: #4cc9f0; text-align: center; margin-bottom: 15px; font-size: 1.3em; padding-bottom: 15px; border-bottom: 2px solid rgba(76, 201, 240, 0.3); text-transform: uppercase; letter-spacing: 1px;">‚öîÔ∏è Main Plot Hooks</h3>
                <div id="main-plot-hooks" style="flex: 1;"></div>
            </div>
            
            <!-- Character Motivations -->
            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(0, 0, 0, 0.3)); border: 1px solid rgba(255, 215, 0, 0.4); border-radius: 0; padding: 25px; display: flex; flex-direction: column; min-height: 400px;">
                <h3 style="color: #ffd700; text-align: center; margin-bottom: 15px; font-size: 1.3em; padding-bottom: 15px; border-bottom: 2px solid rgba(255, 215, 0, 0.3); text-transform: uppercase; letter-spacing: 1px;">üí´ Character Motivations</h3>
                <div id="character-motivations" style="flex: 1;"></div>
            </div>
            
            <!-- NPCs -->
            <div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(0, 0, 0, 0.3)); border: 1px solid rgba(168, 85, 247, 0.4); border-radius: 0; padding: 25px; display: flex; flex-direction: column; min-height: 400px;">
                <h3 style="color: #a855f7; text-align: center; margin-bottom: 15px; font-size: 1.3em; padding-bottom: 15px; border-bottom: 2px solid rgba(168, 85, 247, 0.3); text-transform: uppercase; letter-spacing: 1px;">üë• NPCs</h3>
                <div id="npcs" style="flex: 1;"></div>
            </div>
            
            <!-- Side Quests -->
            <div style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(0, 0, 0, 0.3)); border: 1px solid rgba(34, 197, 94, 0.4); border-radius: 0; padding: 25px; display: flex; flex-direction: column; min-height: 400px;">
                <h3 style="color: #22c55e; text-align: center; margin-bottom: 15px; font-size: 1.3em; padding-bottom: 15px; border-bottom: 2px solid rgba(34, 197, 94, 0.3); text-transform: uppercase; letter-spacing: 1px;">üìú Side Quests</h3>
                <div id="side-quests" style="flex: 1;"></div>
            </div>
            
            <!-- Locations -->
            <div style="background: linear-gradient(135deg, rgba(251, 146, 60, 0.15), rgba(0, 0, 0, 0.3)); border: 1px solid rgba(251, 146, 60, 0.4); border-radius: 0; padding: 25px; display: flex; flex-direction: column; min-height: 400px;">
                <h3 style="color: #fb923c; text-align: center; margin-bottom: 15px; font-size: 1.3em; padding-bottom: 15px; border-bottom: 2px solid rgba(251, 146, 60, 0.3); text-transform: uppercase; letter-spacing: 1px;">üó∫Ô∏è Locations</h3>
                <div id="locations" style="flex: 1;"></div>
            </div>
            
            <!-- Twists -->
            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(0, 0, 0, 0.3)); border: 1px solid rgba(239, 68, 68, 0.4); border-radius: 0; padding: 25px; display: flex; flex-direction: column; min-height: 400px;">
                <h3 style="color: #ef4444; text-align: center; margin-bottom: 15px; font-size: 1.3em; padding-bottom: 15px; border-bottom: 2px solid rgba(239, 68, 68, 0.3); text-transform: uppercase; letter-spacing: 1px;">üé≠ Twists</h3>
                <div id="twists" style="flex: 1;"></div>
            </div>
        </div>
    </div>
</div>
</div>

<script>
// Game mode from localStorage
let gameMode = localStorage.getItem('rpgGameMode') || 'action';

// Character Builder Form Handler
let characterSheetData = null;
let questLogData = [];

document.addEventListener('DOMContentLoaded', () => {
    // Tutorial card toggle functionality
    const tutorialHeaders = document.querySelectorAll('.tutorial-header');
    tutorialHeaders.forEach(header => {
        header.addEventListener('click', function() {
            const card = this.parentElement;
            card.classList.toggle('expanded');
        });
    });

    const questForm = document.getElementById('quest-form');
    if (questForm) {
        questForm.addEventListener('submit', handleQuestSubmit);
    }
    
    // Load existing quest log
    loadQuestLog();
});

// Quest Tracker Handler
async function handleQuestSubmit(event) {
    event.preventDefault();
    
    // Get user session data
    const userSession = localStorage.getItem('userSession');
    if (!userSession) {
        alert('Please login first to create quests!');
        window.location.href = '/rpg/login';
        return;
    }
    
    const sessionData = JSON.parse(userSession);
    
    const questData = {
        title: document.getElementById('quest-title').value,
        location: document.getElementById('quest-location').value,
        objective: document.getElementById('quest-objective').value,
        difficulty: document.getElementById('quest-difficulty').value,
        reward: document.getElementById('quest-reward').value,
        gameMode: gameMode,
        userGithubId: sessionData.githubId  // Add user ID
    };
    
    try {
        const response = await fetch('http://localhost:8587/api/rpg/quest', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(questData)
        });
        
        if (response.ok) {
            const result = await response.json();
            questLogData.push(result);
            displayQuestLog();
            event.target.reset();
            alert('‚úÖ Quest added to your log!');
        } else {
            alert('Error adding quest. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Could not connect to server. Please make sure the Flask backend is running.');
    }
}

async function loadQuestLog() {
    // Get user session data
    const userSession = localStorage.getItem('userSession');
    if (!userSession) {
        return; // Don't load quests if not logged in
    }
    
    const sessionData = JSON.parse(userSession);
    
    try {
        const response = await fetch(`http://localhost:8587/api/rpg/quests?userGithubId=${encodeURIComponent(sessionData.githubId)}`);
        if (response.ok) {
            const result = await response.json();
            questLogData = result.quests || [];
            if (questLogData.length > 0) {
                displayQuestLog();
            }
        }
    } catch (error) {
        console.error('Error loading quest log:', error);
    }
}

function displayQuestLog() {
    const resultBox = document.getElementById('quest-log-result');
    const content = document.getElementById('quest-log-content');
    
    if (questLogData.length === 0) {
        content.innerHTML = '<p style="color: #c0c0c0; text-align: center; font-style: italic;">No quests yet. Add your first quest above!</p>';
        resultBox.classList.add('active');
        return;
    }
    
    const locationIcons = {
        'town': 'üèòÔ∏è',
        'dungeon': '‚õèÔ∏è',
        'forest': 'üå≤',
        'mountain': '‚õ∞Ô∏è',
        'castle': 'üè∞',
        'cave': 'üï≥Ô∏è',
        'ocean': 'üåä',
        'desert': 'üèúÔ∏è'
    };
    
    const difficultyStars = {
        'easy': '‚≠ê',
        'medium': '‚≠ê‚≠ê',
        'hard': '‚≠ê‚≠ê‚≠ê',
        'epic': '‚≠ê‚≠ê‚≠ê‚≠ê'
    };
    
    let questsHTML = '';
    questLogData.forEach((quest, index) => {
        questsHTML += `
            <div style="margin-bottom: 20px; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; border-left: 4px solid #ffd700;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="color: #ffd700; margin: 0; font-size: 1.3em;">${locationIcons[quest.location] || 'üìç'} ${quest.title}</h3>
                    <span style="color: #ffed4e; font-size: 0.9em;">#${index + 1}</span>
                </div>
                <p style="color: #ffed4e; margin: 5px 0;"><strong>Location:</strong> ${quest.location.charAt(0).toUpperCase() + quest.location.slice(1)}</p>
                <p style="color: #e0e0e0; margin: 10px 0; line-height: 1.6;"><strong style="color: #ffed4e;">Objective:</strong> ${quest.objective}</p>
                <div style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 215, 0, 0.2);">
                    <span style="color: #c0c0c0;"><strong style="color: #ffed4e;">Difficulty:</strong> ${difficultyStars[quest.difficulty]} ${quest.difficulty.charAt(0).toUpperCase() + quest.difficulty.slice(1)}</span>
                    <span style="color: #c0c0c0;"><strong style="color: #ffed4e;">Reward:</strong> ${quest.reward}</span>
                </div>
            </div>
        `;
    });
    
    content.innerHTML = questsHTML;
    resultBox.classList.add('active');
}

function downloadQuestLog() {
    if (questLogData.length === 0) {
        alert('No quests to download!');
        return;
    }
    
    let textContent = `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    QUEST LOG - ${gameMode === 'cozy' ? 'COZY RPG' : 'ACTION RPG'}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Total Quests: ${questLogData.length}

`;
    
    questLogData.forEach((quest, index) => {
        textContent += `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
QUEST #${index + 1}: ${quest.title}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Location: ${quest.location.charAt(0).toUpperCase() + quest.location.slice(1)}
Difficulty: ${quest.difficulty.charAt(0).toUpperCase() + quest.difficulty.slice(1)}

Objective:
${quest.objective}

Reward: ${quest.reward}

`;
    });
    
    textContent += `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Created on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    `;
    
    const blob = new Blob([textContent], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `QuestLog_${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
}

// Navigation Sidebar Functionality
const sidebar = document.getElementById('rpg-nav-sidebar');
const navToggle = document.getElementById('nav-toggle');
const currentPage = 3; // This is page 3

// Toggle sidebar
navToggle.addEventListener('click', () => {
  sidebar.classList.toggle('open');
});

// Track page visit
function trackPageVisit(pageNumber) {
  let visitedPages = JSON.parse(localStorage.getItem('rpgVisitedPages') || '[]');
  if (!visitedPages.includes(pageNumber)) {
    visitedPages.push(pageNumber);
    localStorage.setItem('rpgVisitedPages', JSON.stringify(visitedPages));
  }
}

// Check if review page should be unlocked
function updateReviewLock() {
  const visitedPages = JSON.parse(localStorage.getItem('rpgVisitedPages') || '[]');
  const requiredPages = [2, 3, 4, 5];
  const allVisited = requiredPages.every(page => visitedPages.includes(page));
  
  const reviewLink = document.getElementById('review-link');
  if (reviewLink) {
    if (allVisited) {
      reviewLink.classList.remove('locked');
    } else {
      reviewLink.classList.add('locked');
    }
  }
}

// Update visited page indicators
function updateVisitedIndicators() {
  const visitedPages = JSON.parse(localStorage.getItem('rpgVisitedPages') || '[]');
  document.querySelectorAll('.nav-link').forEach(link => {
    const pageNum = parseInt(link.dataset.page);
    if (visitedPages.includes(pageNum)) {
      link.classList.add('visited');
    }
  });
}

// Track current page visit
trackPageVisit(currentPage);
updateVisitedIndicators();
updateReviewLock();
</script>

<script type="module">
  import { javaURI, pythonURI, fetchOptions } from '{{ site.baseurl }}/assets/js/api/config.js';

  // Category to container mapping
  const categoryContainers = {
    "Main Plot Hooks": "main-plot-hooks",
    "Side Quests": "side-quests",
    "Character Motivations": "character-motivations",
    "Locations": "locations",
    "NPCs": "npcs",
    "Twists": "twists"
  };

  // keys for story element reactions
  const LOVE = "love";
  const SKIP = "skip";

  // prepare fetch urls (using RPG story API)
  const url = `${pythonURI}/api/rpg/story`;
  const getURL = url + "/";
  const loveURL = url + "/love/";  
  const skipURL = url + "/skip/";

  // prepare fetch PUT options
  const reactOptions = {...fetchOptions,
    method: 'PUT',
  };

  // fetch the API to obtain story elements
  fetch(getURL, fetchOptions)
    .then(response => {
      if (response.status !== 200) {
        error('GET API response failure: ' + response.status);
        return;
      }
      response.json().then(data => {
        console.log("Backend response:", data);
        console.log("Data type:", typeof data);
        console.log("Is array?", Array.isArray(data));
        
        // Check if data is wrapped in an object
        const storyElements = Array.isArray(data) ? data : (data.story_elements || data.data || []);
        console.log("Story elements to display:", storyElements);
        
        if (storyElements.length === 0) {
          error('No story elements found. Make sure initStoryElements() was called.');
          return;
        }
        
        console.log("Total elements:", storyElements.length);
        
        // Format and organize story elements by category
        for (const row of storyElements) {
          console.log("Processing row:", row);
          
          const containerId = categoryContainers[row.category];
          if (!containerId) {
            console.warn("Unknown category:", row.category);
            continue;
          }
          
          const container = document.getElementById(containerId);
          if (!container) {
            console.warn("Container not found for:", containerId);
            continue;
          }
          
          // Limit to 5 items per category
          if (container.children.length >= 5) {
            console.log("Skipping - already have 5 items in", row.category);
            continue;
          }
            
            // Create item for each story element (no individual boxes)
            const item = document.createElement("div");
            item.style.padding = "12px 0";
            item.style.borderBottom = "1px solid rgba(255, 215, 0, 0.1)";
            item.style.transition = "all 0.3s ease";
            
            item.onmouseover = function() {
              this.style.background = "rgba(255, 215, 0, 0.05)";
            };
            item.onmouseout = function() {
              this.style.background = "transparent";
            };
            
            // Story element text
            const elementText = document.createElement("div");
            elementText.style.color = "#e0e0e0";
            elementText.style.marginBottom = "10px";
            elementText.style.lineHeight = "1.6";
            elementText.style.fontSize = "0.95em";
            elementText.innerHTML = row.element;
            
            // Buttons container
            const btnContainer = document.createElement("div");
            btnContainer.style.display = "flex";
            btnContainer.style.gap = "8px";
            btnContainer.style.justifyContent = "center";
            
            // Love button
            const loveBtn = document.createElement('button');
            loveBtn.id = LOVE + row.id;
            loveBtn.innerHTML = "üíñ<br>" + row.love;
            loveBtn.style.flex = "1";
            loveBtn.style.padding = "8px 12px";
            loveBtn.style.background = "rgba(76, 201, 240, 0.2)";
            loveBtn.style.border = "2px solid rgba(76, 201, 240, 0.5)";
            loveBtn.style.borderRadius = "8px";
            loveBtn.style.color = "#4cc9f0";
            loveBtn.style.cursor = "pointer";
            loveBtn.style.fontFamily = "'Cinzel', 'Georgia', serif";
            loveBtn.style.transition = "all 0.3s ease";
            loveBtn.style.fontSize = "0.9em";
          loveBtn.onmouseover = function() {
            this.style.background = "rgba(76, 201, 240, 0.4)";
            this.style.transform = "scale(1.05)";
          };
          loveBtn.onmouseout = function() {
            this.style.background = "rgba(76, 201, 240, 0.2)";
            this.style.transform = "scale(1)";
          };
          loveBtn.onclick = function () {
            reaction(LOVE, loveURL + row.id, loveBtn.id);
          };          // Skip button
          const skipBtn = document.createElement('button');
          skipBtn.id = SKIP + row.id;
          skipBtn.innerHTML = "‚è≠Ô∏è<br>" + row.skip;
          skipBtn.style.flex = "1";
          skipBtn.style.padding = "8px 12px";
          skipBtn.style.background = "rgba(255, 107, 107, 0.2)";
          skipBtn.style.border = "2px solid rgba(255, 107, 107, 0.5)";
          skipBtn.style.borderRadius = "8px";
          skipBtn.style.color = "#ff6b6b";
          skipBtn.style.cursor = "pointer";
          skipBtn.style.fontFamily = "'Cinzel', 'Georgia', serif";
          skipBtn.style.transition = "all 0.3s ease";
          skipBtn.style.fontSize = "0.9em";
          skipBtn.onmouseover = function() {
            this.style.background = "rgba(255, 107, 107, 0.4)";
            this.style.transform = "scale(1.05)";
          };
          skipBtn.onmouseout = function() {
            this.style.background = "rgba(255, 107, 107, 0.2)";
            this.style.transform = "scale(1)";
          };
          skipBtn.onclick = function () {
            reaction(SKIP, skipURL + row.id, skipBtn.id);
          };
          
          // Assemble the item
          btnContainer.appendChild(loveBtn);
          btnContainer.appendChild(skipBtn);
          item.appendChild(elementText);
          item.appendChild(btnContainer);
          container.appendChild(item);
        }
      })
    })
    .catch(err => {
      error(err + ": " + getURL);
    });

  // Function and interval to refresh the love and skip counts every 5 seconds
  function refreshReactions() {
    fetch(getURL, fetchOptions)
      .then(response => response.json())
      .then(data => {
        // update all reaction data
        for (const row of data) {
          const loveBtn = document.getElementById(LOVE + row.id);
          if (loveBtn) loveBtn.innerHTML = "üíñ<br>" + row.love;
          const skipBtn = document.getElementById(SKIP + row.id);
          if (skipBtn) skipBtn.innerHTML = "‚è≠Ô∏è<br>" + row.skip;
        }
      })
      .catch(err => {
        console.error('Refresh error:', err);
      });
  }
  // Call refreshReactions every 5 seconds
  setInterval(refreshReactions, 5000);

  // Reaction function to love or skip user actions
  function reaction(type, postURL, elemID) {
    // fetch the API
    fetch(postURL, reactOptions)
    .then(response => {
      // check for response errors
      if (response.status !== 200) {
          error("Post API response failure: " + response.status)
          return;
      }
      // valid response will have JSON data
      response.json().then(data => {
          console.log(data);
          // Love or Skip updated/incremented
          if (type === LOVE)
            document.getElementById(elemID).innerHTML = "üíñ<br>" + data.love;
          else if (type === SKIP)
            document.getElementById(elemID).innerHTML = "‚è≠Ô∏è<br>" + data.skip;
          else
            error("unknown type: " + type);
      })
    })
    .catch(err => {
      error(err + " " + postURL);
    });
  }

  // Something went wrong with actions or responses
  function error(err) {
    console.error(err);
    // Display error in first container
    const firstContainer = document.getElementById("main-plot-hooks");
    if (firstContainer) {
      const errorDiv = document.createElement("div");
      errorDiv.style.padding = "15px";
      errorDiv.style.color = "#ff6b6b";
      errorDiv.style.background = "rgba(255, 107, 107, 0.1)";
      errorDiv.style.border = "2px solid rgba(255, 107, 107, 0.3)";
      errorDiv.style.borderRadius = "8px";
      errorDiv.innerHTML = err;
      firstContainer.appendChild(errorDiv);
    }
  }

</script>